"use strict";
// TODO: support non ascii
function isSpace(char) {
    return /^\s$/.test(char);
}
function isIdentStart(char) {
    return /^[a-zA-Z_]$/.test(char);
}
function isIdent(char) {
    return /^[0-9a-zA-Z_]$/.test(char);
}
function isReservedSymbol(char) {
    return ['"', "'", '(', ')', '{', '}', '[', ']', '#'].includes(char);
}
function isSymbol(char) {
    if (isReservedSymbol(char) || (char == '_')) {
        return false;
    }
    ;
    return /^[\u0021-\u002F\u003A-\u0040\u005B-\u0060\u007B-\u007E]$/.test(char);
}
function isNumberStart(char) {
    return /^[0-9]$/.test(char);
}
function isNumber(char) {
    return /^[0-9_]$/.test(char);
}
class Lexer {
    constructor(byChar) {
        this.lastChar = null;
        this.lastToken = null;
        this.finished = false;
        this.chars = byChar[Symbol.iterator]();
    }
    nextChar() {
        if (this.lastChar && this.lastChar.use) {
            this.lastChar.use = false;
            return this.lastChar.char;
        }
        ;
        let { done, value: char } = this.chars.next();
        if (done) {
            return null;
        }
        ;
        this.lastChar = { char, use: false };
        return char;
    }
    ;
    unreadChar() {
        if (!this.lastChar || this.lastChar.use) {
            throw "internal error";
        }
        ;
        this.lastChar.use = true;
    }
    ;
    takeWhile(predicate) {
        let str = "";
        while (true) {
            let char = this.nextChar();
            if (!char) {
                return str;
            }
            if (!predicate(char)) {
                this.unreadChar();
                return str;
            }
            ;
            str += char;
        }
        ;
    }
    ;
    nextToken() {
        if (this.lastToken && this.lastToken.use) {
            this.lastToken.use = false;
            return this.lastToken.token;
        }
        ;
        let char = this.nextChar();
        if (!char) {
            if (!this.finished) {
                this.finished = true;
                return { kind: "eol" };
            }
            ;
            return null;
        }
        ;
        if (isSpace(char)) {
            if (char == '\n') {
                return { kind: "eol" };
            }
            ;
            while (true) {
                char = this.nextChar();
                if (!char) {
                    return { kind: "eol" };
                }
                ;
                if (!isSpace(char)) {
                    break;
                }
                ;
                if (char == '\n') {
                    return { kind: "eol" };
                }
                ;
            }
            ;
        }
        ;
        if (isReservedSymbol(char)) {
            throw "impl";
        }
        else if (isIdentStart(char)) {
            this.unreadChar();
            return { kind: "ref", value: this.takeWhile(isIdent) };
        }
        else if (isNumberStart(char)) {
            throw "impl";
        }
        else if (isSymbol(char)) {
            throw "impl";
        }
        else {
            // TODO: quote char when necessary
            throw new Error("unknown character ${char}");
        }
        ;
    }
    ;
    [Symbol.iterator]() {
        return new TokenIterator(this);
    }
    ;
}
;
class TokenIterator {
    constructor(lexer) {
        this.lexer = lexer;
    }
    ;
    next() {
        let token = this.lexer.nextToken();
        if (!token) {
            // the type of Iterator requires that we always return a valid Token
            // so we return eol here
            return { done: true, value: { kind: "eol" } };
        }
        ;
        return { done: false, value: token };
    }
    ;
}
;
let lexer = new Lexer("hello world bitch");
for (let ch of lexer) {
    console.log(ch);
}
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyYXRjaC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNjcmF0Y2gudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQTBFQSwwQkFBMEI7QUFFMUIsU0FBUyxPQUFPLENBQUMsSUFBWTtJQUM1QixPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDMUIsQ0FBQztBQUVELFNBQVMsWUFBWSxDQUFDLElBQVk7SUFDakMsT0FBTyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2pDLENBQUM7QUFFRCxTQUFTLE9BQU8sQ0FBQyxJQUFZO0lBQzVCLE9BQU8sZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3BDLENBQUM7QUFFRCxTQUFTLGdCQUFnQixDQUFDLElBQVk7SUFDckMsT0FBTyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3JFLENBQUM7QUFFRCxTQUFTLFFBQVEsQ0FBQyxJQUFZO0lBQzdCLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLEVBQUU7UUFDNUMsT0FBTyxLQUFLLENBQUM7S0FDYjtJQUFBLENBQUM7SUFDRixPQUFPLDBEQUEwRCxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM5RSxDQUFDO0FBRUQsU0FBUyxhQUFhLENBQUMsSUFBWTtJQUNsQyxPQUFPLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDN0IsQ0FBQztBQUVELFNBQVMsUUFBUSxDQUFDLElBQVk7SUFDN0IsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlCLENBQUM7QUFFRCxNQUFNLEtBQUs7SUFNVixZQUFZLE1BQXdCO1FBSnBDLGFBQVEsR0FBd0MsSUFBSSxDQUFDO1FBQ3JELGNBQVMsR0FBd0MsSUFBSSxDQUFDO1FBQ3RELGFBQVEsR0FBRyxLQUFLLENBQUM7UUFHaEIsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7SUFDeEMsQ0FBQztJQUVELFFBQVE7UUFDUCxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUU7WUFDdkMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDO1lBQzFCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7U0FDMUI7UUFBQSxDQUFDO1FBQ0YsSUFBSSxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUM1QyxJQUFJLElBQUksRUFBRTtZQUNULE9BQU8sSUFBSSxDQUFDO1NBQ1o7UUFBQSxDQUFDO1FBQ0YsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFDLENBQUM7UUFDbkMsT0FBTyxJQUFJLENBQUM7SUFDYixDQUFDO0lBQUEsQ0FBQztJQUVGLFVBQVU7UUFDVCxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRTtZQUN4QyxNQUFNLGdCQUFnQixDQUFDO1NBQ3ZCO1FBQUEsQ0FBQztRQUNGLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQztJQUMxQixDQUFDO0lBQUEsQ0FBQztJQUVGLFNBQVMsQ0FBQyxTQUFvQztRQUM3QyxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUM7UUFDYixPQUFPLElBQUksRUFBRTtZQUNaLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUMzQixJQUFJLENBQUMsSUFBSSxFQUFFO2dCQUNWLE9BQU8sR0FBRyxDQUFDO2FBQ1g7WUFDRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUNyQixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBQ2xCLE9BQU8sR0FBRyxDQUFDO2FBQ1g7WUFBQSxDQUFDO1lBQ0YsR0FBRyxJQUFJLElBQUksQ0FBQztTQUNaO1FBQUEsQ0FBQztJQUNILENBQUM7SUFBQSxDQUFDO0lBRUYsU0FBUztRQUNSLElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRTtZQUN6QyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUM7WUFDM0IsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQztTQUM1QjtRQUFBLENBQUM7UUFFRixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDM0IsSUFBSSxDQUFDLElBQUksRUFBRTtZQUNWLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNuQixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztnQkFDckIsT0FBTyxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsQ0FBQzthQUNyQjtZQUFBLENBQUM7WUFDRixPQUFPLElBQUksQ0FBQztTQUNaO1FBQUEsQ0FBQztRQUVGLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ2xCLElBQUksSUFBSSxJQUFJLElBQUksRUFBRTtnQkFDakIsT0FBTyxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsQ0FBQzthQUNyQjtZQUFBLENBQUM7WUFDRixPQUFPLElBQUksRUFBRTtnQkFDWixJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUN2QixJQUFJLENBQUMsSUFBSSxFQUFFO29CQUNWLE9BQU8sRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLENBQUM7aUJBQ3JCO2dCQUFBLENBQUM7Z0JBQ0YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtvQkFDbkIsTUFBTTtpQkFDTjtnQkFBQSxDQUFDO2dCQUNGLElBQUksSUFBSSxJQUFJLElBQUksRUFBRTtvQkFDakIsT0FBTyxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsQ0FBQztpQkFDckI7Z0JBQUEsQ0FBQzthQUNGO1lBQUEsQ0FBQztTQUNGO1FBQUEsQ0FBQztRQUVGLElBQUksZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDM0IsTUFBTSxNQUFNLENBQUM7U0FDYjthQUFNLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzlCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUNsQixPQUFPLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsRUFBQyxDQUFDO1NBQ3JEO2FBQU0sSUFBSSxhQUFhLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDL0IsTUFBTSxNQUFNLENBQUM7U0FDYjthQUFNLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzFCLE1BQU0sTUFBTSxDQUFDO1NBQ2I7YUFBTTtZQUNOLGtDQUFrQztZQUNsQyxNQUFNLElBQUksS0FBSyxDQUFDLDJCQUEyQixDQUFDLENBQUM7U0FDN0M7UUFBQSxDQUFDO0lBQ0gsQ0FBQztJQUFBLENBQUM7SUFFRixDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7UUFDaEIsT0FBTyxJQUFJLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBQUEsQ0FBQztDQUNGO0FBQUEsQ0FBQztBQUVGLE1BQU0sYUFBYTtJQUdsQixZQUFZLEtBQVk7UUFDdkIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDcEIsQ0FBQztJQUFBLENBQUM7SUFFRixJQUFJO1FBQ0gsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNuQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1gsb0VBQW9FO1lBQ3BFLHdCQUF3QjtZQUN4QixPQUFPLEVBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLEVBQUMsQ0FBQztTQUMxQztRQUFBLENBQUM7UUFDRixPQUFPLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFDLENBQUM7SUFDcEMsQ0FBQztJQUFBLENBQUM7Q0FDRjtBQUFBLENBQUM7QUFFRixJQUFJLEtBQUssR0FBRyxJQUFJLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0FBQzNDLEtBQUssSUFBSSxFQUFFLElBQUksS0FBSyxFQUFFO0lBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7Q0FDaEI7QUFBQSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsidHlwZSBSZWYgPSB7XG5cdGtpbmQ6IFwicmVmXCI7XG5cdHZhbHVlOiBzdHJpbmc7XG59O1xuXG50eXBlIFFTeW1ib2wgPSB7XG5cdGtpbmQ6IFwic3ltYm9sXCI7XG5cdHZhbHVlOiBzdHJpbmc7XG59O1xuXG50eXBlIFFBdG9tID0ge1xuXHRraW5kOiBcImF0b21cIjtcblx0dmFsdWU6IHN0cmluZztcbn07XG5cbnR5cGUgUU51bWJlciA9IHtcblx0a2luZDogXCJudW1iZXJcIjtcblx0dmFsdWU6IGJpZ2ludDtcbn07XG5cbnR5cGUgUVN0cmluZyA9IHtcblx0a2luZDogXCJzdHJpbmdcIjtcblx0dmFsdWU6IHN0cmluZztcbn07XG5cbnR5cGUgT3BlbkJyYWNrZXQgPSB7XG5cdGtpbmQ6IFwiKFwiO1xufTtcblxudHlwZSBDbG9zZWRCcmFja2V0ID0ge1xuXHRraW5kOiBcIilcIjtcbn07XG5cbnR5cGUgT3BlbkN1cmx5ID0ge1xuXHRraW5kOiBcIntcIjtcbn07XG5cbnR5cGUgQ2xvc2VkQ3VybHkgPSB7XG5cdGtpbmQ6IFwifVwiO1xufTtcblxudHlwZSBPcGVuU3F1YXJlID0ge1xuXHRraW5kOiBcIltcIjtcbn07XG5cbnR5cGUgQ2xvc2VkU3F1YXJlID0ge1xuXHRraW5kOiBcIl1cIjtcbn07XG5cbnR5cGUgRW5kT2ZMaW5lID0ge1xuXHRraW5kOiBcImVvbFwiO1xufTtcblxudHlwZSBUb2tlbiA9XG5cdHwgUmVmXG5cdHwgUVN5bWJvbFxuXHR8IFFBdG9tXG5cdHwgUU51bWJlclxuXHR8IFFTdHJpbmdcblx0fCBPcGVuQnJhY2tldFxuXHR8IENsb3NlZEJyYWNrZXRcblx0fCBPcGVuQ3VybHlcblx0fCBDbG9zZWRDdXJseVxuXHR8IE9wZW5TcXVhcmVcblx0fCBDbG9zZWRTcXVhcmVcblx0fCBFbmRPZkxpbmU7XG5cbnR5cGUgVG9rZW5XaXRoUG9zaXRpb24gPSB7XG5cdHBhdGg6IHN0cmluZztcblx0bGluZTogbnVtYmVyO1xuXHRjb2x1bW46IG51bWJlcjtcblx0dG9rZW46IFRva2VuO1xufTtcblxuLy8gVE9ETzogc3VwcG9ydCBub24gYXNjaWlcblxuZnVuY3Rpb24gaXNTcGFjZShjaGFyOiBzdHJpbmcpOiBib29sZWFuIHtcblx0cmV0dXJuIC9eXFxzJC8udGVzdChjaGFyKTtcbn1cblxuZnVuY3Rpb24gaXNJZGVudFN0YXJ0KGNoYXI6IHN0cmluZyk6IGJvb2xlYW4ge1xuXHRyZXR1cm4gL15bYS16QS1aX10kLy50ZXN0KGNoYXIpO1xufVxuXG5mdW5jdGlvbiBpc0lkZW50KGNoYXI6IHN0cmluZyk6IGJvb2xlYW4ge1xuXHRyZXR1cm4gL15bMC05YS16QS1aX10kLy50ZXN0KGNoYXIpO1xufVxuXG5mdW5jdGlvbiBpc1Jlc2VydmVkU3ltYm9sKGNoYXI6IHN0cmluZyk6IGJvb2xlYW4ge1xuXHRyZXR1cm4gWydcIicsIFwiJ1wiLCAnKCcsICcpJywgJ3snLCAnfScsICdbJywgJ10nLCAnIyddLmluY2x1ZGVzKGNoYXIpO1xufVxuXG5mdW5jdGlvbiBpc1N5bWJvbChjaGFyOiBzdHJpbmcpOiBib29sZWFuIHtcblx0aWYgKGlzUmVzZXJ2ZWRTeW1ib2woY2hhcikgfHwgKGNoYXIgPT0gJ18nKSkge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblx0cmV0dXJuIC9eW1xcdTAwMjEtXFx1MDAyRlxcdTAwM0EtXFx1MDA0MFxcdTAwNUItXFx1MDA2MFxcdTAwN0ItXFx1MDA3RV0kLy50ZXN0KGNoYXIpO1xufVxuXG5mdW5jdGlvbiBpc051bWJlclN0YXJ0KGNoYXI6IHN0cmluZyk6IGJvb2xlYW4ge1xuXHRyZXR1cm4gL15bMC05XSQvLnRlc3QoY2hhcik7XG59XG5cbmZ1bmN0aW9uIGlzTnVtYmVyKGNoYXI6IHN0cmluZyk6IGJvb2xlYW4ge1xuXHRyZXR1cm4gL15bMC05X10kLy50ZXN0KGNoYXIpO1xufVxuXG5jbGFzcyBMZXhlciBpbXBsZW1lbnRzIEl0ZXJhYmxlPFRva2VuPiB7XG5cdGNoYXJzOiBJdGVyYXRvcjxzdHJpbmc+O1xuXHRsYXN0Q2hhcjoge2NoYXI6IHN0cmluZywgdXNlOiBib29sZWFufSB8IG51bGwgPSBudWxsO1xuXHRsYXN0VG9rZW46IHt0b2tlbjogVG9rZW4sIHVzZTogYm9vbGVhbn0gfCBudWxsID0gbnVsbDtcblx0ZmluaXNoZWQgPSBmYWxzZTtcblxuXHRjb25zdHJ1Y3RvcihieUNoYXI6IEl0ZXJhYmxlPHN0cmluZz4pIHtcblx0XHR0aGlzLmNoYXJzID0gYnlDaGFyW1N5bWJvbC5pdGVyYXRvcl0oKTtcblx0fVxuXG5cdG5leHRDaGFyKCk6IHN0cmluZyB8IG51bGwge1xuXHRcdGlmICh0aGlzLmxhc3RDaGFyICYmIHRoaXMubGFzdENoYXIudXNlKSB7XG5cdFx0XHR0aGlzLmxhc3RDaGFyLnVzZSA9IGZhbHNlO1xuXHRcdFx0cmV0dXJuIHRoaXMubGFzdENoYXIuY2hhcjtcblx0XHR9O1xuXHRcdGxldCB7ZG9uZSwgdmFsdWU6IGNoYXJ9ID0gdGhpcy5jaGFycy5uZXh0KCk7XG5cdFx0aWYgKGRvbmUpIHtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH07XG5cdFx0dGhpcy5sYXN0Q2hhciA9IHtjaGFyLCB1c2U6IGZhbHNlfTtcblx0XHRyZXR1cm4gY2hhcjtcblx0fTtcblxuXHR1bnJlYWRDaGFyKCk6IHZvaWQge1xuXHRcdGlmICghdGhpcy5sYXN0Q2hhciB8fCB0aGlzLmxhc3RDaGFyLnVzZSkge1xuXHRcdFx0dGhyb3cgXCJpbnRlcm5hbCBlcnJvclwiO1xuXHRcdH07XG5cdFx0dGhpcy5sYXN0Q2hhci51c2UgPSB0cnVlO1xuXHR9O1xuXG5cdHRha2VXaGlsZShwcmVkaWNhdGU6IChjaGFyOiBzdHJpbmcpID0+IGJvb2xlYW4pOiBzdHJpbmcge1xuXHRcdGxldCBzdHIgPSBcIlwiO1xuXHRcdHdoaWxlICh0cnVlKSB7XG5cdFx0XHRsZXQgY2hhciA9IHRoaXMubmV4dENoYXIoKTtcblx0XHRcdGlmICghY2hhcikge1xuXHRcdFx0XHRyZXR1cm4gc3RyO1xuXHRcdFx0fVxuXHRcdFx0aWYgKCFwcmVkaWNhdGUoY2hhcikpIHtcblx0XHRcdFx0dGhpcy51bnJlYWRDaGFyKCk7XG5cdFx0XHRcdHJldHVybiBzdHI7XG5cdFx0XHR9O1xuXHRcdFx0c3RyICs9IGNoYXI7XG5cdFx0fTtcblx0fTtcblxuXHRuZXh0VG9rZW4oKTogVG9rZW4gfCBudWxsIHtcblx0XHRpZiAodGhpcy5sYXN0VG9rZW4gJiYgdGhpcy5sYXN0VG9rZW4udXNlKSB7XG5cdFx0XHR0aGlzLmxhc3RUb2tlbi51c2UgPSBmYWxzZTtcblx0XHRcdHJldHVybiB0aGlzLmxhc3RUb2tlbi50b2tlbjtcblx0XHR9O1xuXG5cdFx0bGV0IGNoYXIgPSB0aGlzLm5leHRDaGFyKCk7XG5cdFx0aWYgKCFjaGFyKSB7XG5cdFx0XHRpZiAoIXRoaXMuZmluaXNoZWQpIHtcblx0XHRcdFx0dGhpcy5maW5pc2hlZCA9IHRydWU7XG5cdFx0XHRcdHJldHVybiB7a2luZDogXCJlb2xcIn07XG5cdFx0XHR9O1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fTtcblxuXHRcdGlmIChpc1NwYWNlKGNoYXIpKSB7XG5cdFx0XHRpZiAoY2hhciA9PSAnXFxuJykge1xuXHRcdFx0XHRyZXR1cm4ge2tpbmQ6IFwiZW9sXCJ9O1xuXHRcdFx0fTtcblx0XHRcdHdoaWxlICh0cnVlKSB7XG5cdFx0XHRcdGNoYXIgPSB0aGlzLm5leHRDaGFyKCk7XG5cdFx0XHRcdGlmICghY2hhcikge1xuXHRcdFx0XHRcdHJldHVybiB7a2luZDogXCJlb2xcIn07XG5cdFx0XHRcdH07XG5cdFx0XHRcdGlmICghaXNTcGFjZShjaGFyKSkge1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9O1xuXHRcdFx0XHRpZiAoY2hhciA9PSAnXFxuJykge1xuXHRcdFx0XHRcdHJldHVybiB7a2luZDogXCJlb2xcIn07XG5cdFx0XHRcdH07XG5cdFx0XHR9O1xuXHRcdH07XG5cblx0XHRpZiAoaXNSZXNlcnZlZFN5bWJvbChjaGFyKSkge1xuXHRcdFx0dGhyb3cgXCJpbXBsXCI7XG5cdFx0fSBlbHNlIGlmIChpc0lkZW50U3RhcnQoY2hhcikpIHtcblx0XHRcdHRoaXMudW5yZWFkQ2hhcigpO1xuXHRcdFx0cmV0dXJuIHtraW5kOiBcInJlZlwiLCB2YWx1ZTogdGhpcy50YWtlV2hpbGUoaXNJZGVudCl9O1xuXHRcdH0gZWxzZSBpZiAoaXNOdW1iZXJTdGFydChjaGFyKSkge1xuXHRcdFx0dGhyb3cgXCJpbXBsXCI7XG5cdFx0fSBlbHNlIGlmIChpc1N5bWJvbChjaGFyKSkge1xuXHRcdFx0dGhyb3cgXCJpbXBsXCI7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIFRPRE86IHF1b3RlIGNoYXIgd2hlbiBuZWNlc3Nhcnlcblx0XHRcdHRocm93IG5ldyBFcnJvcihcInVua25vd24gY2hhcmFjdGVyICR7Y2hhcn1cIik7XG5cdFx0fTtcblx0fTtcblxuXHRbU3ltYm9sLml0ZXJhdG9yXSgpOiBJdGVyYXRvcjxUb2tlbj4ge1xuXHRcdHJldHVybiBuZXcgVG9rZW5JdGVyYXRvcih0aGlzKTtcblx0fTtcbn07XG5cbmNsYXNzIFRva2VuSXRlcmF0b3IgaW1wbGVtZW50cyBJdGVyYXRvcjxUb2tlbj4ge1xuXHRsZXhlcjogTGV4ZXI7XG5cblx0Y29uc3RydWN0b3IobGV4ZXI6IExleGVyKSB7XG5cdFx0dGhpcy5sZXhlciA9IGxleGVyO1xuXHR9O1xuXG5cdG5leHQoKToge2RvbmU6IGJvb2xlYW4sIHZhbHVlOiBUb2tlbn0ge1xuXHRcdGxldCB0b2tlbiA9IHRoaXMubGV4ZXIubmV4dFRva2VuKCk7XG5cdFx0aWYgKCF0b2tlbikge1xuXHRcdFx0Ly8gdGhlIHR5cGUgb2YgSXRlcmF0b3IgcmVxdWlyZXMgdGhhdCB3ZSBhbHdheXMgcmV0dXJuIGEgdmFsaWQgVG9rZW5cblx0XHRcdC8vIHNvIHdlIHJldHVybiBlb2wgaGVyZVxuXHRcdFx0cmV0dXJuIHtkb25lOiB0cnVlLCB2YWx1ZToge2tpbmQ6IFwiZW9sXCJ9fTtcblx0XHR9O1xuXHRcdHJldHVybiB7ZG9uZTogZmFsc2UsIHZhbHVlOiB0b2tlbn07XG5cdH07XG59O1xuXG5sZXQgbGV4ZXIgPSBuZXcgTGV4ZXIoXCJoZWxsbyB3b3JsZCBiaXRjaFwiKTtcbmZvciAobGV0IGNoIG9mIGxleGVyKSB7XG5cdGNvbnNvbGUubG9nKGNoKTtcbn07XG4iXX0=